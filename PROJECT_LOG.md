# Avocado Project Log

最后更新: 2026-02-27

## 文档说明（固定模板）
- 记录格式模板（改动历史）: `YYYY-MM-DD | 变更主题 | 文件 | 行为变化 | 风险/回滚 | TODO`
- 任务卡模板（TODO）: `ID | 标题 | 状态 | 验收标准 | 优先级 | 依赖 | 最后更新`
- 维护规则: 每次 Codex 完成代码改动后，必须同步更新本文件的「改动历史」「TODO 看板」及必要的约定章节。

## 项目目标与范围
### 当前目标
- 短期目标: 实现可运行的 Python + Docker 常驻服务，支持 CalDAV 日历读取、AI 临时日历同步、AI 调度回写与差异检测。
- 中期目标: 提供内网 Web 管理后台，支持配置管理、同步状态查看、规则维护与手动触发同步。

### Out of Scope（当前明确不做）
- 不实现复杂多租户与 RBAC 权限系统。
- 不实现企业级外部密钥管理系统对接（首版先使用本地配置文件）。
- 不拆分多文档体系（首阶段由本文件作为唯一事实源）。

### 关键约束
- 技术栈: Python。
- 部署方式: Docker 常驻 daemon。
- 同步策略: 定时轮询 + 手动触发。
- 规划窗口: 按自然日计算，默认未来 7 天，可配置长度。
- 冲突策略: 用户修改优先。

## 系统约定（长期有效）
### ADR-lite（精简架构决策）
- ADR-001: 项目文档治理采用单文件 `PROJECT_LOG.md`，作为需求、演进和任务状态唯一事实源。
- ADR-002: `README.md` 保持简洁，仅作为入口说明并链接本文件。
- ADR-003: 改动历史按功能/任务记录，不按每次提交流水记账。

### 数据与接口约定
- `[AI Task]` 模块放置于日历事件 `DESCRIPTION` 字段，使用结构化 YAML 块。
- `[AI Task]` 至少包含字段: `locked`、`mandatory`、`editable_fields`、`user_intent`、`updated_at`。
- 配置文件采用 `config.yaml`（后续可在后台维护），至少包含:
  - CalDAV: `base_url`、`username`、`password`
  - AI: `base_url`、`api_key`、`model`
  - Sync: `window_days`、`interval_seconds`、`timezone`

### 兼容性与安全约束
- 首版后台仅内网访问，不内置登录认证。
- 敏感信息不可写入公开日志，调试输出需对密钥做掩码处理。
- 行为变化若涉及接口/策略，必须同步更新本章节或「项目目标与范围」。

## 改动历史（按功能/任务，最新在上）
| 日期 | 变更主题 | 涉及文件 | 行为变化 | 风险与回滚点 | 关联 TODO |
| --- | --- | --- | --- | --- | --- |
| 2026-02-27 | 建立项目长期文档治理基线 | `PROJECT_LOG.md`, `README.md` | 新增唯一事实源文档、模板、TODO 看板与维护规则；README 增加文档入口 | 风险低；如需回滚可删除 `PROJECT_LOG.md` 并恢复 README 链接 | AVO-001 |

## TODO 看板
### Todo
| ID | 标题 | 状态 | 验收标准 | 优先级 | 依赖项 | 最后更新 |
| --- | --- | --- | --- | --- | --- | --- |
| AVO-002 | 初始化 Python 服务骨架与 Docker 运行框架 | Todo | 启动后可加载配置并运行基础服务循环 | P0 | AVO-001 | 2026-02-27 |
| AVO-003 | 实现 CalDAV 日历发现与固定日历规则管理 | Todo | 可列出日历并保存“自动建议 + 手工确认”结果 | P0 | AVO-002 | 2026-02-27 |
| AVO-004 | 实现 `[AI Task]` YAML 解析与回写模块 | Todo | 可稳定注入、解析、更新模块且不破坏原描述文本 | P0 | AVO-002 | 2026-02-27 |
| AVO-005 | 实现同步引擎（未来窗口、差异识别、冲突处理） | Todo | 可执行一轮完整同步并遵守“用户修改优先” | P0 | AVO-003, AVO-004 | 2026-02-27 |
| AVO-006 | 接入 OpenAI 兼容接口并完成 AI 结果回写 | Todo | 可从配置读取模型参数并完成两阶段写回（临时->用户） | P0 | AVO-005 | 2026-02-27 |
| AVO-007 | 内网 Web 后台（配置、状态、手动同步） | Todo | 页面可编辑配置并触发同步，查看最近执行状态 | P1 | AVO-002, AVO-005 | 2026-02-27 |

### In Progress
| ID | 标题 | 状态 | 验收标准 | 优先级 | 依赖项 | 最后更新 |
| --- | --- | --- | --- | --- | --- | --- |
| (空) | - | - | - | - | - | - |

### Done
| ID | 标题 | 状态 | 验收标准 | 优先级 | 依赖项 | 最后更新 |
| --- | --- | --- | --- | --- | --- | --- |
| AVO-001 | 建立项目长期同步文档机制 | Done | 根目录存在 `PROJECT_LOG.md`，包含目标/约定/历史/TODO/快照，README 提供入口 | P0 | 无 | 2026-02-27 |

## 当前状态快照
### 当前版本关键能力
- 已建立项目级文档治理与长期维护规范。
- 已定义统一模板与任务看板格式，便于 Codex 持续更新。
- 已建立 README 到项目事实源文档的导航入口。

### 当前已知问题（Known issues）
- 业务代码尚未开始实现（CalDAV、AI 调度、Web 后台均为待开发状态）。
- 安全策略目前仅定义原则，尚未落地到运行时代码。

### 下一阶段目标（最多 3 条）
- 完成 Python 工程骨架与 Docker 运行框架（AVO-002）。
- 打通 CalDAV 连接与日历规则管理（AVO-003）。
- 实现 `[AI Task]` 模块解析/回写并接入同步引擎（AVO-004, AVO-005）。
