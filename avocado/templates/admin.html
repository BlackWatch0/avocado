<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Avocado Admin</title>
  <link rel="stylesheet" href="/static/admin.css">
</head>
<body>
  <main class="page">
    <header class="top">
      <h1 data-i18n="page.title">Avocado Admin</h1>
      <div class="top-right">
        <label class="lang-switch">
          <span data-i18n="lang.label">Language</span>
          <select id="lang-select">
            <option value="auto">Auto</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
          </select>
        </label>
        <div class="actions">
          <button id="sync-btn" type="button" data-i18n="action.run_sync">Run Sync</button>
          <button id="refresh-calendars-btn" type="button" data-i18n="action.refresh_calendars">Refresh Calendars</button>
          <button id="save-btn" type="button" data-i18n="action.save_config">Save Config</button>
        </div>
      </div>
    </header>

    <section id="status" class="status info" data-i18n="status.loading_config">Loading config...</section>

    <nav class="tabs">
      <button id="tab-config" type="button" class="tab active" data-i18n="tab.config">Config</button>
      <button id="tab-calendars" type="button" class="tab" data-i18n="tab.calendars">Calendars</button>
      <button id="tab-logs" type="button" class="tab" data-i18n="tab.logs">Logs</button>
    </nav>

    <form id="config-form">
      <section class="card" data-panel="config">
        <h2 data-i18n="section.caldav">CalDAV</h2>
        <label><span data-i18n="field.base_url">Base URL</span><input id="caldav-base-url" type="text" required></label>
        <label><span data-i18n="field.username">Username</span><input id="caldav-username" type="text" required></label>
        <label><span data-i18n="field.password">Password</span><input id="caldav-password" type="password" data-i18n-placeholder="placeholder.keep_secret"></label>
      </section>

      <section class="card" data-panel="config">
        <h2 data-i18n="section.ai">AI</h2>
        <label>
          <span data-i18n="field.base_url">Base URL</span>
          <input id="ai-base-url" type="text" required>
        </label>
        <div class="inline-link-wrap">
          <a id="ai-test-link" href="#" class="inline-link" data-i18n="ai.test_link">Test AI API connectivity</a>
        </div>
        <label><span data-i18n="field.api_key">API Key</span><input id="ai-api-key" type="password" data-i18n-placeholder="placeholder.keep_secret"></label>
        <label><span data-i18n="field.model">Model</span><input id="ai-model" type="text" required></label>
        <label><span data-i18n="field.timeout_seconds">Timeout Seconds</span><input id="ai-timeout-seconds" type="number" min="1" required></label>
        <label><span data-i18n="field.system_prompt">System Prompt</span><textarea id="ai-system-prompt" rows="10"></textarea></label>
      </section>

      <section class="card" data-panel="config">
        <h2 data-i18n="section.sync">Sync</h2>
        <label><span data-i18n="field.window_days">Window Days</span><input id="sync-window-days" type="number" min="1" required></label>
        <label><span data-i18n="field.interval_seconds">Interval Seconds</span><input id="sync-interval-seconds" type="number" min="30" required></label>
        <label><span data-i18n="field.timezone">Timezone</span>
          <select id="sync-timezone" required>
            <option value="UTC">UTC</option>
            <option value="Asia/Shanghai">Asia/Shanghai</option>
            <option value="Asia/Tokyo">Asia/Tokyo</option>
            <option value="Asia/Singapore">Asia/Singapore</option>
            <option value="Asia/Kolkata">Asia/Kolkata</option>
            <option value="Europe/London">Europe/London</option>
            <option value="Europe/Berlin">Europe/Berlin</option>
            <option value="Europe/Paris">Europe/Paris</option>
            <option value="Europe/Moscow">Europe/Moscow</option>
            <option value="America/New_York">America/New_York</option>
            <option value="America/Chicago">America/Chicago</option>
            <option value="America/Denver">America/Denver</option>
            <option value="America/Los_Angeles">America/Los_Angeles</option>
            <option value="America/Toronto">America/Toronto</option>
            <option value="America/Sao_Paulo">America/Sao_Paulo</option>
            <option value="Australia/Sydney">Australia/Sydney</option>
            <option value="Australia/Melbourne">Australia/Melbourne</option>
            <option value="Pacific/Auckland">Pacific/Auckland</option>
          </select>
        </label>
        <div class="range-sync-wrap">
          <label><span data-i18n="field.custom_sync_start">Custom Sync Start</span><input id="sync-custom-start" type="datetime-local"></label>
          <label><span data-i18n="field.custom_sync_end">Custom Sync End</span><input id="sync-custom-end" type="datetime-local"></label>
          <button id="custom-sync-btn" type="button" data-i18n="action.run_custom_sync">Run Custom Range Sync</button>
        </div>
      </section>

      <section class="card" data-panel="config">
        <h2 data-i18n="section.calendar_rules">Calendar Rules</h2>
        <label><span data-i18n="field.immutable_keywords">Immutable Keywords (comma separated)</span><input id="rules-immutable-keywords" type="text"></label>
        <label><span data-i18n="field.immutable_calendar_ids">Immutable Calendar IDs (auto-filled from calendar table)</span><textarea id="rules-immutable-calendar-ids" rows="4" readonly></textarea></label>
        <label><span data-i18n="field.staging_calendar_id">Staging Calendar ID</span><input id="rules-staging-calendar-id" type="text"></label>
        <label><span data-i18n="field.staging_calendar_name">Staging Calendar Name</span><input id="rules-staging-calendar-name" type="text"></label>
        <label><span data-i18n="field.user_calendar_id">User Calendar ID</span><input id="rules-user-calendar-id" type="text"></label>
        <label><span data-i18n="field.user_calendar_name">User Calendar Name</span><input id="rules-user-calendar-name" type="text"></label>
        <label><span data-i18n="field.intake_calendar_id">Intake Calendar ID</span><input id="rules-intake-calendar-id" type="text"></label>
        <label><span data-i18n="field.intake_calendar_name">Intake Calendar Name</span><input id="rules-intake-calendar-name" type="text"></label>
      </section>

      <section class="card" data-panel="config">
        <h2 data-i18n="section.task_defaults">Task Defaults</h2>
        <label class="checkbox"><input id="task-locked" type="checkbox"> <span data-i18n="field.locked">Locked</span></label>
        <label class="checkbox"><input id="task-mandatory" type="checkbox"> <span data-i18n="field.mandatory">Mandatory</span></label>
        <label><span data-i18n="field.editable_fields">Editable Fields (comma separated)</span><input id="task-editable-fields" type="text"></label>
      </section>

      <section class="card wide" data-panel="calendars">
        <h2 data-i18n="section.calendars">Calendars (from CalDAV)</h2>
        <p class="muted" data-i18n="hint.refresh_calendars">Click Sync or Refresh Calendars to load latest list from server.</p>
        <div class="table-wrap">
          <table id="calendar-behaviors-table">
            <thead>
              <tr>
                <th data-i18n="table.name">Name</th>
                <th data-i18n="table.immutable">Immutable</th>
                <th data-i18n="table.default_locked">Default Locked</th>
                <th data-i18n="table.default_mandatory">Default Mandatory</th>
              </tr>
            </thead>
            <tbody id="calendar-behaviors-body"></tbody>
          </table>
        </div>
      </section>

      <section class="card wide logs-shell" data-panel="logs">
        <h2 data-i18n="section.logs">Run Logs</h2>
        <div class="logs-grid">
          <section class="log-card">
            <div class="log-card-head">
              <h3 data-i18n="section.sync_logs">Sync Runs</h3>
              <button id="refresh-sync-logs-btn" type="button" data-i18n="action.refresh_sync_logs">Refresh Sync Logs</button>
            </div>
            <div class="table-wrap">
              <table class="log-table sync-table">
                <thead>
                  <tr>
                    <th data-i18n="table.run_at">Run At</th>
                    <th data-i18n="table.status">Status</th>
                    <th data-i18n="table.trigger">Trigger</th>
                    <th data-i18n="table.changes">Changes</th>
                    <th data-i18n="table.conflicts">Conflicts</th>
                    <th class="col-message" data-i18n="table.message">Message</th>
                  </tr>
                </thead>
                <tbody id="sync-logs-body"></tbody>
              </table>
            </div>
          </section>

          <section class="log-card">
            <div class="log-card-head">
              <h3 data-i18n="section.audit_logs">Audit Events</h3>
              <button id="refresh-audit-logs-btn" type="button" data-i18n="action.refresh_audit_logs">Refresh Audit Logs</button>
            </div>
            <div class="table-wrap">
              <table class="log-table audit-table">
                <thead>
                  <tr>
                    <th data-i18n="table.created_at">Created At</th>
                    <th data-i18n="table.action">Action</th>
                    <th data-i18n="table.calendar">Calendar</th>
                    <th data-i18n="table.uid">UID</th>
                    <th class="col-details" data-i18n="table.details">Details</th>
                  </tr>
                </thead>
                <tbody id="audit-logs-body"></tbody>
              </table>
            </div>
          </section>
        </div>
      </section>
    </form>
  </main>

  <script src="/static/admin.js"></script>
</body>
</html>

