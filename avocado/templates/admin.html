<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Avocado Admin</title>
  <link rel="stylesheet" href="/static/admin.css">
</head>
<body>
  <main class="page">
    <header class="top">
      <h1>Avocado Admin</h1>
      <div class="actions">
        <button id="test-ai-btn" type="button">Test AI API</button>
        <button id="sync-btn" type="button">Run Sync</button>
        <button id="refresh-calendars-btn" type="button">Refresh Calendars</button>
        <button id="save-btn" type="button">Save Config</button>
      </div>
    </header>

    <section id="status" class="status info">Loading config...</section>

    <nav class="tabs">
      <button id="tab-config" type="button" class="tab active">Config</button>
      <button id="tab-calendars" type="button" class="tab">Calendars</button>
      <button id="tab-logs" type="button" class="tab">Logs</button>
    </nav>

    <form id="config-form">
      <section class="card" data-panel="config">
        <h2>CalDAV</h2>
        <label>Base URL<input id="caldav-base-url" type="text" required></label>
        <label>Username<input id="caldav-username" type="text" required></label>
        <label>Password<input id="caldav-password" type="password" placeholder="Leave empty to keep current"></label>
      </section>

      <section class="card" data-panel="config">
        <h2>AI</h2>
        <label>Base URL<input id="ai-base-url" type="text" required></label>
        <label>API Key<input id="ai-api-key" type="password" placeholder="Leave empty to keep current"></label>
        <label>Model<input id="ai-model" type="text" required></label>
        <label>Timeout Seconds<input id="ai-timeout-seconds" type="number" min="1" required></label>
        <label>System Prompt<textarea id="ai-system-prompt" rows="10"></textarea></label>
      </section>

      <section class="card" data-panel="config">
        <h2>Sync</h2>
        <label>Window Days<input id="sync-window-days" type="number" min="1" required></label>
        <label>Interval Seconds<input id="sync-interval-seconds" type="number" min="30" required></label>
        <label>Timezone
          <select id="sync-timezone" required>
            <option value="UTC">UTC</option>
            <option value="Asia/Shanghai">Asia/Shanghai</option>
            <option value="Asia/Tokyo">Asia/Tokyo</option>
            <option value="Asia/Singapore">Asia/Singapore</option>
            <option value="Asia/Kolkata">Asia/Kolkata</option>
            <option value="Europe/London">Europe/London</option>
            <option value="Europe/Berlin">Europe/Berlin</option>
            <option value="Europe/Paris">Europe/Paris</option>
            <option value="Europe/Moscow">Europe/Moscow</option>
            <option value="America/New_York">America/New_York</option>
            <option value="America/Chicago">America/Chicago</option>
            <option value="America/Denver">America/Denver</option>
            <option value="America/Los_Angeles">America/Los_Angeles</option>
            <option value="America/Toronto">America/Toronto</option>
            <option value="America/Sao_Paulo">America/Sao_Paulo</option>
            <option value="Australia/Sydney">Australia/Sydney</option>
            <option value="Australia/Melbourne">Australia/Melbourne</option>
            <option value="Pacific/Auckland">Pacific/Auckland</option>
          </select>
        </label>
      </section>

      <section class="card" data-panel="config">
        <h2>Calendar Rules</h2>
        <label>Immutable Keywords (comma separated)<input id="rules-immutable-keywords" type="text"></label>
        <label>Immutable Calendar IDs (auto-filled from calendar table)<textarea id="rules-immutable-calendar-ids" rows="4" readonly></textarea></label>
        <label>Staging Calendar ID<input id="rules-staging-calendar-id" type="text"></label>
        <label>Staging Calendar Name<input id="rules-staging-calendar-name" type="text"></label>
        <label>User Calendar ID<input id="rules-user-calendar-id" type="text"></label>
        <label>User Calendar Name<input id="rules-user-calendar-name" type="text"></label>
      </section>

      <section class="card" data-panel="config">
        <h2>Task Defaults</h2>
        <label class="checkbox"><input id="task-locked" type="checkbox"> Locked</label>
        <label class="checkbox"><input id="task-mandatory" type="checkbox"> Mandatory</label>
        <label>Editable Fields (comma separated)<input id="task-editable-fields" type="text"></label>
      </section>

      <section class="card wide" data-panel="calendars">
        <h2>Calendars (from CalDAV)</h2>
        <p class="muted">Click Sync or Refresh Calendars to load latest list from server.</p>
        <div class="table-wrap">
          <table id="calendar-behaviors-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Immutable</th>
                <th>Default Locked</th>
                <th>Default Mandatory</th>
              </tr>
            </thead>
            <tbody id="calendar-behaviors-body"></tbody>
          </table>
        </div>
      </section>

      <section class="card wide" data-panel="logs">
        <h2>Run Logs</h2>
        <div class="actions in-card">
          <button id="refresh-sync-logs-btn" type="button">Refresh Sync Logs</button>
          <button id="refresh-audit-logs-btn" type="button">Refresh Audit Logs</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Run At</th>
                <th>Status</th>
                <th>Trigger</th>
                <th>Changes</th>
                <th>Conflicts</th>
                <th>Message</th>
              </tr>
            </thead>
            <tbody id="sync-logs-body"></tbody>
          </table>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Created At</th>
                <th>Action</th>
                <th>Calendar</th>
                <th>UID</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="audit-logs-body"></tbody>
          </table>
        </div>
      </section>
    </form>
  </main>

  <script src="/static/admin.js"></script>
</body>
</html>
